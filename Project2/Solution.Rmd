---
title: "Project 2"
author: "Jawaid Hakim"
date: "`r Sys.Date()`"
output:
  
  pdf_document: 
    toc: true
    toc_depth: 3
    number_sections: true
  html_document:
    
    toc: true
    toc_depth: 3
    toc_float: true
    number_sections: true
boxlinks: true
urlcolor: blue
always_allow_html: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

# Assignment

## Data set 1 from Jhalak Das

Let's load CSV file containing the data.

```{r load-data}
df <- read.csv("jhalak_das.csv")
```

A quick look at the data frame structure identifies some **wider** data characteristics:

1. Terms scores separate columns
1. **sex and age** are concatenated into a single column
1. Personal data of students (name, sex, phone) intermingled with test data

```{r}
str(df)
head(df)
```

Let's start by separating **send and age** column into **sex** and **age** columns. Note, during separation we also convert **age** into integer. 

```{r separate-cols}
df <- df %>%
    separate('sex.and.age', sep = '_', into = c('sex', 'age'), convert = TRUE)
head(df)
```

Next, we **pivot longer** by collapsing the term column names into a **term** column and putting the values into a **score** column.

```{r pivot-longer}
df <- df %>%
        pivot_longer(cols = 7:9,
                     names_to = "term",     # col with term names 
                     values_to = "score")   # col with scores
head(df)
```

Let's clean up strings: uppercase, trim, replace '.' in term data with space.

```{r trim}
df <- df %>%        
        mutate(name = str_to_upper(str_trim(name))) %>% 
        mutate(sex = str_to_upper(str_trim(sex))) %>%           
        mutate(test.number = str_to_upper(str_trim(test.number))) %>% 
        mutate(term = str_replace(str_to_upper(str_trim(term)), '\\.', ' '))
head(df)
```

Next, we separate the table into two. First table contains personal details of students (id, name, phone, sex).

```{r extract-personal-data}
df_personal <- df %>%
            select(id, name, phone, sex) %>%
            distinct(id, .keep_all = TRUE) %>%
            arrange(id)
head(df_personal)
```

And the second table contains key identifying details of students and test scores (id, name, test.number, term, score). Note, strictly speaking the **id** is sufficient to identify students but also having the **name** in this table is convenient.

```{r extract-test-data}
df_test <- df %>%
            select(id, name, test.number, term, score) %>%
            distinct(id, .keep_all = TRUE) %>%
            arrange(id)
head(df_test)
```
